<html lang="en">
<head>
	<title>CodeCraft</title>
	<!-- <link rel="shortcut icon" href="iconCoC.png">   -->
	<style>
		body {
			background-color: #000000;
			margin: 0px;
			overflow: hidden;
		}

		::-webkit-scrollbar {
    		width: .0em;
		}
	</style>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/threejs/r69/three.js"></script>	
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
<link rel="stylesheet" href="jquery-ui/TechGreen.css">
<script src='craftData.js'></script>
<!-- <script src="craftData.js"></script> -->
<!-- <script src="three.min.js"></script> -->
<body oncontextmenu="return false;" onselectstart="return false;">
<center>	
	<div id='menu'><br>
		<button id='start'>Start Game</button><br>
	    <button id='craft'>Select Craft</button><br>
	    <button id='level'>Select Level</button><br>
		<button id='engin'>Engineering</button>
	</div>	
	<div id='motionStatus'>
	</div>
	<div id='selCraft'>
		<button id='kernel'>Model-001 Kernel</button><br>
		<button id='quad'>Model-002 Quad</button><br>
		<button id='fighter'>Model-003 Fighter</button><br>
		<button id='upload'>upload ...</button>
	</div>	
		<button id='straight'> straight</button><br>
		<button id='lightning'>lightning</button><br>
	<div id='selectRunway'>
	</div>
</center>
<script>
    $("#menu").dialog({
    	title:'Main Menu',
    	position:{at:"center center"},
    	width:150,height:220,
    	resizable:false,
    	draggable:false,
    	open: function(){
    		$(".ui-dialog-titlebar-close").hide();
    	},
		show:{effect: "clip",duration: 200},
		hide:{effect: "clip",duration: 200}
    });

		$("#start").button().click(function(){
			$("#menu").dialog('close')
			$("#motionStatus").dialog('open')
			timer.start()
			// timer.stop()
			// timer.running=false
			renderer.domElement.requestPointerLock = 
				renderer.domElement.requestPointerLock ||
				renderer.domElement.mozRequestPointerLock ||
				renderer.domElement.webkitRequestPointerLock;
			renderer.domElement.requestPointerLock()
			renderer.domElement.addEventListener('mousemove', mousemoveReact);
			// document.addEventListener('keydown', ctrlKernel, false );
			// document.addEventListener('keyup', ctrlKernel, false );
			// document.addEventListener('keydown', ctrlQuad, false );	
			// document.addEventListener('keyup', ctrlQuad, false );
			// document.addEventListener('keydown', ctrlFight);
			// document.addEventListener('keyup', ctrlFight);	
			// setInterval('render()',60)
			runway.resetColor(0)
			setInterval('flash()',10)		
		});
		function escPress(event){
			switch(event.keyCode){
			case 27:
	    	// location.reload()
	    	timer.stop()
	    	// timer=new THREE.Clock()
	    	// clearInterval('flash()')
	    	console.log(timer.autoStart)
	    	craft.accelera.set(0,0,0)
	    	craft.velocity.set(0,0,0)
	    	craft.position.set(0,20,-100)
	    	craft.rotaAcce.set(0,0,0)
	    	craft.rotaVelo.set(0,0,0)
	    	craft.rotation.set(0,0,0)
	    	presentGate=0
	    	runway.resetColor(-1)
	    	radius=200
	    	thita=0.5,phai=-1.55;
			// renderer.domElement.removeEventListener('mousemove', mousemoveReact);
			// document.removeEventListener('keydown', ctrlFight);
			// document.removeEventListener('keyup', ctrlFight);
			$("#menu").dialog('open');
			$('#selCraft').dialog('close')
			$('#motionStatus').dialog('close')
			break;
			}
		}
		$("#craft").button().click(function(){
			$("#menu").dialog('close')
			$('#selCraft').dialog('open')
			radius=50
		});

		$("#level").button()
		$("#engin").button().click(function(){});
		$("#upload").button()

	$('#motionStatus').dialog({
    	title:'Motion Status',
    	position:{at:"left bottom"},
    	width:300,height:180,
    	resizable:false,
    	draggable:false,
    	open: function(){
    		$(".ui-dialog-titlebar-close").hide();
    	},
    	show:{effect: "clip",duration: 200},
		hide:{effect: "clip",duration: 200}
    })
    $('#motionStatus').dialog('close')

    $('#selCraft').dialog({
    	title:'Select Craft',
    	position:{at:"right center"},
    	width:200,height:400,
    	autoOpen:false,
    	resizable:false,
    	draggable:false,
    	open: function(){
    		$(".ui-dialog-titlebar-close").hide();
    	},
		show:{effect: "clip",duration: 200},
		hide:{effect: "clip",duration: 200},
		buttons: {
	        'Pick Out': function() {
				$("#menu").dialog('open')
				$('#selCraft').dialog('close')
				radius=200
	        }
      	}
    })
    $('#selCraft').dialog('close')

    	$("#kernel").button().click(function(){
    		scene.remove(craft)
    		buildCraft(kernel)
    		scene.add(craft)
    		craft.position.set(0,20,-100)
    		removeAllCtrl()
    		document.addEventListener('keydown', ctrlKernel, false );
			document.addEventListener('keyup', ctrlKernel, false );
    	})
    	$("#quad").button().click(function(){
    		scene.remove(craft)
    		buildCraft(quadcopter)
    		scene.add(craft)
    		craft.position.set(0,20,-100)
    		removeAllCtrl()
    		document.addEventListener('keydown', ctrlQuad, false );	
			document.addEventListener('keyup', ctrlQuad, false );
    	})
    	$("#fighter").button().click(function(){
    		scene.remove(craft)
    		buildCraft(fighter)
    		scene.add(craft)
    		craft.position.set(0,20,-100)
    		removeAllCtrl()
    		document.addEventListener('keydown', ctrlFight, false );
			document.addEventListener('keyup', ctrlFight, false );
    	})
    	function removeAllCtrl(){
    		document.removeEventListener('keydown',ctrlKernel);
			document.removeEventListener('keyup',ctrlKernel);
			document.removeEventListener('keydown',ctrlQuad);	
			document.removeEventListener('keyup',ctrlQuad);
			document.removeEventListener('keydown',ctrlFight);
			document.removeEventListener('keyup',ctrlFight);
		}



    // $('#tabs').tabs();

	var CoC={}
	var camera, scene, renderer;
	var windowX = window.innerWidth
	   ,windowY = window.innerHeight;
	var craft,runway,auxPlane,background;
	var radius=200,thita=0.5,phai=-1.55;
	var x0=0,y0=0;
	// var ts=new Date().getTime(),tt
	// var t0=ts,t1,dt
	var timer=new THREE.Clock(false),tt,dt

	var s3d2=Math.sqrt(3)/2,s2d2=Math.sqrt(2)/2

	var presentGate=0

	// init(); to the end 
	function init() {
		camera = new THREE.PerspectiveCamera(40,windowX/windowY,5,10000);
		// camera.position.set(500,100,-100)

		scene = new THREE.Scene();
		scene.fog = new THREE.FogExp2(0x000000,0.001);
		// scene.fog = new THREE.Fog( 0x000000, 3500, 15000 );
		// scene.fog.color.setHSL( 0.51, 0.4, 0.01 );

		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setSize( windowX, windowY );
		renderer.setClearColor ('#000000',1)
		document.body.appendChild( renderer.domElement );

		// Default Craft
		// buildCraft(kernel)	
		// buildCraft(quadcopter)	
		buildCraft(fighter)

		// document.addEventListener('keydown', ctrlKernel, false );
		// document.addEventListener('keyup', ctrlKernel, false );
		// document.addEventListener('keydown', ctrlQuad, false );
		// document.addEventListener('keyup', ctrlQuad, false );
		document.addEventListener('keydown', ctrlFight);
		document.addEventListener('keyup', ctrlFight);
		// 
		scene.add(craft)
		craft.position.set(0,20,-100)	

		buildRunway()
		scene.add(runway)

		setAuxPlane(-1,1,-1,10)
		scene.add(auxPlane)

		setBackground()
		scene.add(background)

		renderer.domElement.addEventListener('mousemove', mousemoveReact);

		document.addEventListener('keydown',escPress);
		document.addEventListener('keyup',escPress);



		setInterval('render()',60)
	}

	function setBackground(){
		background=new THREE.Object3D
		var geometry = new THREE.Geometry();
		for ( var i = 0; i < 10000; i ++ ) {
			var vertex = new THREE.Vector3();
			vertex.x = THREE.Math.randFloatSpread( 2000 );
			vertex.y = THREE.Math.randFloatSpread( 2000 );
			vertex.z = THREE.Math.randFloatSpread( 2000 );
			if(vertex.length()>500){geometry.vertices.push( vertex );}
		}
		var stars=new THREE.PointCloud(geometry,new THREE.PointCloudMaterial({color:0xffffff}));
		background.add(stars);
	}

	THREE.Vector3.prototype.format=function(){
		return [
			Math.round(this.x*100)/100,
			Math.round(this.y*100)/100,
			Math.round(this.z*100)/100
		]
	}	
	THREE.Euler.prototype.format=function(){
		return [
			Math.round(this.x*100)/100,
			Math.round(this.y*100)/100,
			Math.round(this.z*100)/100,
			this.order
		]
	}	

	function render(){
		camera.position.x=craft.position.x+radius*Math.cos(phai)*Math.cos(thita)
		camera.position.z=craft.position.z+radius*Math.sin(phai)*Math.cos(thita)
		camera.position.y=craft.position.y+radius*Math.sin(thita)		
		camera.lookAt( craft.position );
		background.position.copy(camera.position)
		renderer.render( scene, camera );
		$('#motionStatus').html('<br>'+
			'accelera : '+craft.accelera.format()+'<br>'+
			'velocity : '+craft.velocity.format()+'<br>'+
			'position : '+craft.position.format()+'<br>'+
			'rotaAcce : '+craft.rotaAcce.format()+'<br>'+
			'rotaVelo : '+craft.rotaVelo.format()+'<br>'+
			'rotation : '+craft.rotation.format()
			)
	}

	function flash(){	
		var dv,dx,drv,drx	

		dt=timer.getDelta()
		tt=timer.getElapsedTime()

		if(runway.sensor(presentGate)==true){
			presentGate+=1
			if(presentGate==runway.children.length){
				presentGate=0
			}
			runway.resetColor(presentGate)
		}

		craft.accelera=craft.force.clone().divideScalar(craft.mass)
		craft.rotaAcce=craft.torque.clone().applyMatrix4(craft.invIner) // !! not correct
		eular=craft.rotation
		craft.accelera.applyEuler(eular)

		dv=craft.accelera.clone()
		dv.multiplyScalar(dt)
		craft.velocity.add(dv)
		dx=craft.velocity.clone()
		dx.multiplyScalar(dt)
		craft.position.add(dx)

		drv=craft.rotaAcce.clone()
		drv.multiplyScalar(dt)
		craft.rotaVelo.add(drv)
		drx=craft.rotaVelo.clone()
		drx.multiplyScalar(dt)
		craft.rotateOnAxis(drx.clone().normalize(),drx.length())
	}

	function buildCraft(model){
		model=new model // !!??
		craft=new THREE.Object3D()

		craft.mass=model.units.length
		craft.radius=0
		craft.massCenter=new THREE.Vector3()
		craft.force=new THREE.Vector3()	
		craft.accelera=new THREE.Vector3()		
		craft.velocity=new THREE.Vector3()
		craft.inertia=new THREE.Matrix4();
		craft.torque=new THREE.Vector3()
		craft.rotaAcce=new THREE.Vector3()
		craft.rotaVelo=new THREE.Vector3()

		var shift=new THREE.Object3D()
		var units=new Array 
		for(var i=0;i<model.units.length;i++){
			var material = new THREE.SpriteMaterial({
				map:UnitTexture(model.units[i].type)
			} );
			units[i]=new THREE.Sprite( material );
			units[i].position
				.fromArray(model.units[i].position)
			shift.add(units[i])
			craft.massCenter.add(units[i].position)
		}
		craft.massCenter.multiplyScalar(1/craft.mass)
		console.log(craft.massCenter)
		
		
		console.log(shift )		

		var xp,yp,zp,rp // position relative to mass center 
		for(var i=0;i<model.units.length;i++){
			xp=units[i].position.x-craft.massCenter.x
			yp=units[i].position.y-craft.massCenter.y
			zp=units[i].position.z-craft.massCenter.z
			craft.inertia.elements[0]+= yp*yp+zp*zp
			craft.inertia.elements[5]+= xp*xp+zp*zp
			craft.inertia.elements[10]+=xp*xp+yp*yp
			craft.inertia.elements[1]-=xp*yp
			craft.inertia.elements[2]-=xp*zp
			craft.inertia.elements[6]-=yp*zp

			rp=Math.sqrt(xp*xp+yp*yp+zp*zp)
			if(rp>craft.radius){craft.radius=rp}
		}
		craft.inertia.elements[4]=craft.inertia.elements[1]
		craft.inertia.elements[8]=craft.inertia.elements[2]
		craft.inertia.elements[9]=craft.inertia.elements[6]

		var invIner=new THREE.Matrix4().getInverse(craft.inertia.clone())
		console.log(craft.mass,craft.inertia,invIner)

		var jets=new Array
		for(var i=0;i<model.jets.length;i++){
			var len=model.jets[i].len
			   ,dir=new THREE.Vector3().fromArray(model.jets[i].dir)
			   ,end=new THREE.Vector3().fromArray(model.jets[i].end)
			   ,origin,vector
			// end.sub(craft.massCenter)
			vector=dir.clone().multiplyScalar(model.jets[i].len)
			origin=end.clone().sub(vector)
			// jets[i]=CoC.Arrow(origin,vector,0xff0000)
			jets[i]=fire(end,vector)
			jets[i].name=model.jets[i].name
			jets[i].force=dir.clone().multiplyScalar(len*100)
			jets[i].torque=end.clone().cross(jets[i].force)
			jets[i].visible=false
			shift.add(jets[i])
		}
	
		craft.invIner=invIner
		console.log(shift.position.toArray())
		shift.position.sub(craft.massCenter)
		console.log(shift.position.toArray())
		craft.add(shift)

		craft.switchJets=function(name,onoff){
			if(craft.getObjectByName(name).visible==onoff)
			{return}
			craft.getObjectByName(name).visible=onoff
			
			craft.force.set(0,0,0)
			craft.torque.set(0,0,0)
			for(var i=0;i<model.jets.length;i++){
				if(jets[i].visible==false){continue}
				craft.force.add(
					jets[i].force.clone()				   
				)
				craft.torque.add(
					jets[i].torque.clone()
				)
			}
			// craft.accelera=craft.force.clone().divideScalar(craft.mass)
			// craft.rotaAcce=craft.torque.clone().applyMatrix4(craft.invIner) // !! not correct
			// eular=craft.rotation
			// craft.accelera.applyEuler(eular)
		}
	}

	function buildRunway(){
		var checkPoint=[]
		runway=new THREE.Object3D

		for(n=0;n<10;n++){
			checkPoint[n]=setCheckPoint([0,20,n*100])
			runway.add(checkPoint[n])
		}
 

		runway.sensor=function(presentGate){
			var p=presentGate

			var distance=craft.position.clone()
				.sub(checkPoint[p].position).length()
			if(distance<craft.radius){
				console.log('pass gate',p)
				return true
			}
		}
		runway.sensor(0)

		runway.resetColor=function(presentGate){
			var p=presentGate,i=0
			if(p<0){
				for(g=0;g<checkPoint.length;g++){
					checkPoint[g].visible=true
					checkPoint[g].children[0].material.color.setHSL(0,0,1)
				}
				return 0
			}


			for(g=0;g<checkPoint.length;g++){
				checkPoint[g].visible=false
			}
			for(g=p;g<p+5;g++){
				ll=0
				if(g>=checkPoint.length){ll=checkPoint.length}
					console.log(g-ll)
				for(c=0;c<checkPoint[g-ll].children.length;c++){
					var H=checkPoint[g-ll].children[c].material.color.getHSL().h
					   ,S=checkPoint[g-ll].children[c].material.color.getHSL().s
					   ,L=checkPoint[g-ll].children[c].material.color.getHSL().l
					checkPoint[g-ll].visible=true
					checkPoint[g-ll].children[c].material.color.setHSL(H,S,1-i*0.2)
				}
				i++
			}
		}
		// runway.resetColor(0)
	}

	function setCheckPoint(position){
		var geometry,vertex,material,diamond
		var position,normal,arrow,lineColor=0xffffff
		var checkPoint=new THREE.Object3D
		var r=craft.radius

		geometry=new THREE.Geometry();
		vertex=new THREE.Vector3(0,-r,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(-r,0,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0, r,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3( r,0,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0,-r,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0,0,-r);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0, r,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0,0, r);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3( r,0,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0,0,-r);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(-r,0,0);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0,0, r);
		geometry.vertices.push( vertex );
		vertex=new THREE.Vector3(0,-r,0);
		geometry.vertices.push( vertex );

		material=new THREE.LineBasicMaterial({
			color:lineColor,
		})

		diamond = new THREE.Line(geometry,material)
		checkPoint.add(diamond)
		checkPoint.position.fromArray(position)
		return checkPoint
	}

	CoC.Arrow=function(origin,vector,color,head){
		var geometry,material
		var arrow,end,length,twig1,twig2,twig3
		var zz,perpen1,perpen2
		var s3d2=Math.sqrt(3)/2
		length=vector.length()
		zz=new THREE.Vector3(0,0,1)

		if(head==null){head=length*.3}
		if(vector.clone().normalize().equals(zz) ||
		   vector.clone().normalize().negate().equals(zz)){
			perpen1=new THREE.Vector3(1,0,0)
			perpen2=new THREE.Vector3(0,1,0)
		}else{
			perpen1=zz.clone().cross(vector).normalize()
			perpen2=vector.clone().cross(perpen1).normalize()
		}
		end=origin.clone().add(vector)
		twig1=origin.clone()
		 	 .add(vector.clone().setLength(length-head))
		 	 .add(perpen1.clone().setLength(.5*head/3.))
		twig2=origin.clone()
			 .add(vector.clone().setLength(length-head))
			 .add(perpen1.clone().setLength(-.25*head/3.)) 
			 .add(perpen2.clone().setLength(.5*s3d2*head/3.)) 
		twig3=origin.clone()
			 .add(vector.clone().setLength(length-head))
			 .add(perpen1.clone().setLength(-.25*head/3.)) 
			 .add(perpen2.clone().setLength(-.5*s3d2*head/3.)) 

		geometry=new THREE.Geometry();
		geometry.vertices.push(origin);
		geometry.vertices.push(end);
		geometry.vertices.push(twig1);
		geometry.vertices.push(end);
		geometry.vertices.push(twig2);
		geometry.vertices.push(end);
		geometry.vertices.push(twig3);
		material=new THREE.LineBasicMaterial({
			color:color,
		})
		arrow=new THREE.Line(geometry,material)
		return arrow
	}

	fire=function(end,vector){
		var geometry3,vertex, line,colors3 = [];

		geometry3 = new THREE.Geometry()
		// vertex=new THREE.Vector3(0,20,-90);
		geometry3.vertices.push( end);
		colors3[0]=new THREE.Color(0xffff00)
		vertex=end.clone().sub(vector)
		geometry3.vertices.push(vertex);
		colors3[1]=new THREE.Color(0xff0000)
		vertex=end.clone().sub(vector).sub(vector)
		geometry3.vertices.push(vertex);
		colors3[2]=new THREE.Color(0x000000)

		geometry3.colors = colors3;

		material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});
		line=new THREE.Line(geometry3, material );
		return line
	}

	function setAuxPlane(x1,x2,z1,z2){
		var geometry,vertex,material,line
		auxPlane = new THREE.Object3D
		for(var i=x1*10;i<=x2*10;i++){
			var j=0,k=0
			var x=i*10,y=j*10,z=k*10
			geometry=new THREE.Geometry();
			vertex=new THREE.Vector3(x,y,z+z1*100);
			geometry.vertices.push( vertex );
			vertex=new THREE.Vector3(x,y,z+z2*100);
			geometry.vertices.push( vertex );

			lineColor=0x001100
			if(i%10==0){lineColor=0x003300}
			material=new THREE.LineBasicMaterial({
				color:lineColor,
			})
			line = new THREE.Line(geometry,material)
			auxPlane.add( line );
		}
		for(var k=z1*10;k<=z2*10;k++){
			var j=0,i=0
			var x=i*10,y=j*10,z=k*10
			geometry=new THREE.Geometry();
			vertex=new THREE.Vector3(x+x1*100,y,z);
			geometry.vertices.push( vertex );
			vertex=new THREE.Vector3(x+x2*100,y,z);
			geometry.vertices.push( vertex );

			lineColor=0x001100
			if(k%10==0){lineColor=0x003300}
			if(k%100==0){lineColor=0x005500}
			// if(k==0||k==1000){lineColor=0xff0000}
			// if(k%100==0){lineColor=0x00ffff}
			material=new THREE.LineBasicMaterial({
				color:lineColor,
			})
			line = new THREE.Line(geometry,material)
			auxPlane.add( line );
		}
	}

	function UnitTexture(kind){
		var c1,c2 // color outside & inside
		switch(kind){
			case  1:c1='#ffffff'        ;break; // iron
			case  2:c1='#333333'        ;break; // carbon
			case  3:c1='#ff0000'        ;break; // heat vibrate
			case  4:c1='#ffff00'        ;break; // electromagnetic
			case  5:c1='#0000ff'        ;break; // grvity subspace

			case  6:c1='#ff7575'        ;break; // steel
			case  7:c1='#FFFF6F'        ;break; // jet
			case  8:c1='deepskyblue'    ;break; // magnet
			case  9:c1='sandybrown'     ;break; // inertia
			case 10:c1='greenyellow'    ;break; // inertia
			case 11:c1='mediumorchid'   ;break; // inertia

			case 12:c1='silver'         ;break; // inertia

			case 13:c1='#FF0000'        ;break; // inertia
			case 14:c1='gold'           ;break; // inertia
			case 15:c1='#2828FF'        ;break; // inertia
			case 16:c1='orangered'      ;break; // inertia
			case 17:c1='#00FF00'        ;break; // inertia
			case 18:c1='#9F009F'        ;break; // inertia

			case 19:c1='darkred'        ;break; // inertia
			case 20:c1='#5B4B00'        ;break; // inertia
			case 21:c1='#000079'        ;break; // inertia
			case 22:c1='#842B00'        ;break; // inertia
			case 23:c1='#006000'        ;break; // inertia
			case 24:c1='#460046'        ;break; // inertia
		}

		var canvas=document.createElement('canvas');
		canvas.width=100;canvas.height=100
		var ctx=canvas.getContext('2d')
		var texture=new THREE.Texture(canvas)
		texture.needsUpdate=true;

		var grd = ctx.createRadialGradient(35,35, 0, 50, 50, 90);
		grd.addColorStop(0,c1);
		// grd.addColorStop(0,'#ffffff');
		grd.addColorStop(1,'#000000');
		ctx.arc(50,50,50, 0, 2 * Math.PI, false)
		ctx.fillStyle=grd;
		ctx.fill()

		return texture
	}

	function mousemoveReact(event){
		if(event.which==1){
			renderer.domElement.style.cursor = "none"
			x0=event.movementX || event.mozMovementX || event.webkitMovementX || 0;
			y0=event.movementY || event.mozMovementY || event.webkitMovementY || 0;
			phai+=x0*0.002
			thita+=y0*0.002
			if(thita>Math.PI*0.49){thita=Math.PI*0.49}
			if(thita<-Math.PI*0.49){thita=-Math.PI*0.49}
		}else{   
			renderer.domElement.style.cursor = "crosshair"
		}
	}

	function ctrlKernel(event){
		trigger=false
		if(event.type=='keydown'){trigger=true}

		var key=String.fromCharCode(event.keyCode)
		switch(key){
		case 'A':
			craft.switchJets('left',trigger);break;
		case 'F':
			craft.switchJets('right',trigger);break;
		case 'E':
			craft.switchJets('front',trigger);break;
		case 'D':
			craft.switchJets('back',trigger);break;
		case 'W':
			craft.switchJets('up',trigger);break;
		case 'S':
			craft.switchJets('down',trigger);break;
		}
	}

	function ctrlQuad(event){
		trigger=false
		if(event.type=='keydown'){trigger=true}

		var key=String.fromCharCode(event.keyCode)
		switch(key){
		case 'A':
			craft.switchJets('left-up',trigger);
			craft.switchJets('right-down',trigger);
			break;
		case 'F':
			craft.switchJets('left-down',trigger);
			craft.switchJets('right-up',trigger);
			break;
		case 'E':
			craft.switchJets('front-up',trigger);
			craft.switchJets('back-down',trigger);
			break;
		case 'D':
			craft.switchJets('front-down',trigger);
			craft.switchJets('back-up',trigger);
			break;
		case 'W':
			craft.switchJets('left-down',trigger);
			craft.switchJets('right-down',trigger);
			craft.switchJets('front-down',trigger);
			craft.switchJets('back-down',trigger);
			break;
		case 'S':
			craft.switchJets('left-up',trigger);
			craft.switchJets('right-up',trigger);
			craft.switchJets('front-up',trigger);
			craft.switchJets('back-up',trigger);
			break;
		}
	}

	function ctrlFight(event){
		trigger=false
		if(event.type=='keydown'){trigger=true}
		var key=String.fromCharCode(event.keyCode)
		switch(key){
		case 'A':
			craft.switchJets('left-down',trigger);
			craft.switchJets('right-up',trigger);
			break;
		case 'F':
			craft.switchJets('left-up',trigger);
			craft.switchJets('right-down',trigger)
			;break;
		case 'E':
			craft.switchJets('back-1',trigger);
			craft.switchJets('back-2',trigger);
			craft.switchJets('back-3',trigger);
			craft.switchJets('back-4',trigger);break;
		case 'D':
			craft.switchJets('left-1',trigger);
			craft.switchJets('right-1',trigger);
			craft.switchJets('up',trigger);
			craft.switchJets('down',trigger);break;
		case 'W':
			craft.switchJets('up',trigger);
			craft.switchJets('back-0',trigger);break;
		case 'S':
			craft.switchJets('down',trigger);
			craft.switchJets('back-0',trigger);break;
		case 'Q':
			craft.switchJets('left-1',trigger);
			craft.switchJets('back-0',trigger);break;	
		case 'R':
			craft.switchJets('right-1',trigger);
			craft.switchJets('back-0',trigger);break;
		}
	}

	init();
</script>
</body>
</html>
